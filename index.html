<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù†Ø¸Ø§Ù… Ø¹Ø±ÙˆØ¶ Ø£Ø³Ø¹Ø§Ø± UKRA</title>
  
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
  
  <style>
    /* =================================
       1. Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© ÙˆØªØµÙ…ÙŠÙ… Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
       ================================= */
    :root {
      --ukra-gold: #C9A86A;
      --ukra-dark: #0f0f10;
      --ukra-dark-2: #222;
      --font-body: 'Cairo', sans-serif;
      --font-title: 'Playfair Display', serif;
    }
    body {
      font-family: var(--font-body);
      background: #f0f2f5;
      color: #333;
      margin: 0;
      padding: 0;
    }
    .main-container {
      max-width: 1400px;
      margin: 20px auto;
      padding: 15px;
    }
    h1, h2, h3 {
      font-family: var(--font-title);
      color: var(--ukra-dark);
    }

    /* --- ØªØµÙ…ÙŠÙ… Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª (Tabs) --- */
    .tabs {
      display: flex;
      background: #fff;
      border-radius: 8px 8px 0 0;
      box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }
    .tab-button {
      padding: 15px 25px;
      font-size: 1.1rem;
      font-weight: bold;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      color: #777;
    }
    .tab-button.active {
      color: var(--ukra-gold);
      border-bottom-color: var(--ukra-gold);
    }
    .tab-content {
      display: none;
      background: #fff;
      padding: 25px;
      border-radius: 0 0 8px 8px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.05);
    }
    .tab-content.active {
      display: block;
    }

    /* --- ØªØµÙ…ÙŠÙ… Ø§Ù„ÙÙˆØ±Ù… ÙˆØ§Ù„Ø£ÙƒÙˆØ±Ø¯ÙŠÙˆÙ† --- */
    .form-section {
      border: 1px solid #eee;
      border-radius: 8px;
      margin-bottom: 25px;
    }
    .form-section-header {
      background: #f9f9f9;
      padding: 15px 20px;
      border-bottom: 1px solid #eee;
    }
    .form-section-body {
      padding: 20px;
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: bold;
    }
    input[type="text"], input[type="date"], input[type="number"], select, textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-family: var(--font-body);
      font-size: 1rem;
      box-sizing: border-box;
    }
    textarea {
      height: 100px;
      grid-column: 1 / -1; /* Ø¬Ø¹Ù„Ù‡Ø§ ØªÙ…ØªØ¯ Ø¹Ù„Ù‰ Ø¹Ø±Ø¶ Ø§Ù„ÙÙˆØ±Ù… */
    }
    
    /* --- ØªØµÙ…ÙŠÙ… Ø§Ù„Ø£ÙƒÙˆØ±Ø¯ÙŠÙˆÙ† (Accordion) --- */
    .accordion-group {
      border-bottom: 1px solid #eee;
    }
    .accordion-header {
      background: #fdfdfd;
      padding: 15px 20px;
      cursor: pointer;
      font-size: 1.2rem;
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .accordion-header:hover {
      background: #f5f5f5;
    }
    .accordion-body {
      display: none; /* Ù…Ø®ÙÙŠ Ø§ÙØªØ±Ø§Ø¶ÙŠØ§Ù‹ */
      padding: 15px;
    }
    .item-selection-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 10px;
    }
    .item-label {
      display: flex;
      align-items: center;
      padding: 10px;
      border-radius: 4px;
      background: #f9f9f9;
      cursor: pointer;
    }
    .item-label input[type="checkbox"] {
      margin-left: 10px;
      width: 18px;
      height: 18px;
    }
    .item-label:hover {
      background: #eef;
    }
    
    /* --- ØªØµÙ…ÙŠÙ… Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨Ù†ÙˆØ¯ (Ù„Ù„ØªØ¹Ø¯ÙŠÙ„) --- */
    .quote-table-wrapper {
      overflow-x: auto;
    }
    .quote-items-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    .quote-items-table th, .quote-items-table td {
      border: 1px solid #ddd;
      padding: 12px;
      text-align: right;
    }
    .quote-items-table th {
      background: #f4f4f4;
      font-family: var(--font-title);
    }
    .quote-items-table input[type="text"], 
    .quote-items-table input[type="number"] {
      width: 95%;
      padding: 8px;
    }
    .quote-items-table .item-desc-input {
      width: 98%;
      font-size: 0.9rem;
    }
    .quote-items-table .item-qty-input {
      width: 80px;
    }
    
    /* --- ØªØµÙ…ÙŠÙ… Ø³Ø¬Ù„ Ø§Ù„Ø¹Ø±ÙˆØ¶ --- */
    .log-table {
      width: 100%;
      border-collapse: collapse;
    }
    .log-table th, .log-table td {
      border: 1px solid #ddd;
      padding: 12px;
    }
    .log-table tr:hover {
      background: #f9f9f9;
    }
    
    /* --- Ø§Ù„Ø£Ø²Ø±Ø§Ø± --- */
    .button {
      background: var(--ukra-gold);
      color: var(--ukra-dark);
      padding: 12px 20px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 16px;
      font-weight: bold;
      margin: 10px 5px;
      font-family: var(--font-body);
    }
    .button:hover { background: #b08f51; }
    .btn-save { background: #28a745; color: white; }
    .btn-save:hover { background: #218838; }
    .btn-preview { background: #007bff; color: white; }
    .btn-preview:hover { background: #0056b3; }
    .btn-danger { background: #dc3545; color: white; padding: 5px 10px; font-size: 12px; }
    
    /* --- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„ --- */
    #loader {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(255, 255, 255, 0.8);
      z-index: 9998;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 1.5rem;
      font-weight: bold;
      color: var(--ukra-dark);
    }
    #statusMessage {
      text-align: center;
      padding: 15px;
      font-size: 1.1rem;
      margin-top: 10px;
      border-radius: 4px;
      display: none;
    }
    .status-success { background: #d4edda; color: #155724; }
    .status-error { background: #f8d7da; color: #721c24; }
  </style>
</head>
<body>

  <div class="main-container">
    
    <div id="loader">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>
    
    <div id="statusMessage"></div>

    <nav class="tabs">
      <div id="tab-creator" class="tab-button active" onclick="switchTab('creator')">Ø¥Ù†Ø´Ø§Ø¡ / ØªØ¹Ø¯ÙŠÙ„ Ø¹Ø±Ø¶</div>
      <div id="tab-log" class="tab-button" onclick="switchTab('log')">Ø³Ø¬Ù„ Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±</div>
    </nav>

    <div id="creator-view" class="tab-content active">
      
      <div class="form-section">
        <div class="form-section-header"><h2>1. Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©</h2></div>
        <div class="form-section-body">
          
          <input type="hidden" id="currentQuoteId">
          <input type="hidden" id="currentQuoteRowIndex">
          
          <div class="form-group">
            <label for="hotelName">Ø§Ø³Ù… Ø§Ù„ÙÙ†Ø¯Ù‚:</label>
            <input type="text" id="hotelName" placeholder="Ø¥Ø¯Ø§Ø±Ø© ÙÙ†Ø¯Ù‚ ...." onchange="saveDraft()">
          </div>
          <div class="form-group">
            <label for="quoteDate">Ø§Ù„ØªØ§Ø±ÙŠØ®:</label>
            <input type="date" id="quoteDate" onchange="saveDraft()">
          </div>
          <div class="form-group">
            <label for="coverImage">Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„ØºÙ„Ø§Ù (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
            <input type="text" id="coverImage" placeholder="https://example.com/image.png" onchange="saveDraft()">
          </div>
          <div class="form-group" style="grid-column: 1 / -1;">
            <label for="designDescription">ÙˆØµÙ Ø§Ù„ØªØµÙ…ÙŠÙ… (Ø³ÙŠØ¸Ù‡Ø± ÙÙŠ ØµÙØ­Ø© "ÙˆØµÙ Ø§Ù„ØªØµÙ…ÙŠÙ…"):</label>
            <textarea id="designDescription" onchange="saveDraft()">Ø¥Ø³ØªÙ‚Ø¨Ø§Ù„ ÙˆØºØ±Ù ÙÙ†Ø¯Ù‚ÙŠØ© ÙˆÙ…Ù†Ø·Ù‚Ø© Ø·Ø¹Ø§Ù… Ø¨ØªÙƒÙ„ÙØ© Ù…ØªÙˆØ³Ø·Ø©ØŒ ØªØ¬Ù…Ø¹ Ø¨ÙŠÙ† Ø§Ù„Ø±Ø§Ø­Ø© ÙˆØ§Ù„Ø¬Ù…Ø§Ù„ØŒ Ø¨Ø£Ù„ÙˆØ§Ù† Ù…ØªÙˆØ§Ø²Ù†Ø© Ø¨ÙŠÙ† Ø§Ù„ÙØ§ØªØ­ ÙˆØ§Ù„ØºØ§Ù…Ù‚.</textarea>
          </div>
        </div>
      </div>


      <div class="form-section">
        <div class="form-section-header"><h2>âœ¨ Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ (Ø§Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø°ÙƒÙŠ)</h2></div>
        <div class="form-section-body" style="display: block; padding: 20px;">
          <p>Ø§Ø·Ù„Ø¨ Ù…Ù† Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù…Ù„Ø¡ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø§Ù„Ù…Ù‚ØªØ±Ø­Ø©. (Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø¥Ù„Ù‰ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©).</p>
          <div style="display: flex; flex-wrap: wrap; gap: 10px;">
            <button type="button" class="button" style="background: #4a90e2;" onclick="generateAiSelection('economy_room')">
              ğŸ›ï¸ Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© Ø§Ù‚ØªØµØ§Ø¯ÙŠØ©
            </button>
            <button type="button" class="button" style="background: #50e3c2;" onclick="generateAiSelection('medium_room')">
              ğŸ›ï¸ Ø¥Ù†Ø´Ø§Ø¡ ØºØ±ÙØ© Ù…ØªÙˆØ³Ø·Ø©
            </button>
            <button type="button" class="button" style="background: #b8e986;" onclick="generateAiSelection('luxury_reception')">
              ğŸ›‹ï¸ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ ÙØ§Ø®Ø±
            </button>
            </div>
        </div>
      </div>

      <div class="form-section">
        <div class="form-section-header"><h2>2. Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¨Ù†ÙˆØ¯</h2></div>
        <div class="form-section-body" style="display: block;">
          <div class="form-group">
            <label for="priceLevel">Ø§Ø®ØªØ± Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ø¨Ù†ÙˆØ¯:</label>
            <select id="priceLevel">
              <option value="price_medium">Ù…ØªÙˆØ³Ø· (Ø¬ÙˆØ¯Ø© Ø¬ÙŠØ¯Ø©)</option>
              <option value="price_low">Ù…Ù†Ø®ÙØ¶ (Ø§Ù‚ØªØµØ§Ø¯ÙŠ)</option>
              <option value="price_high">Ù…Ø±ØªÙØ¹ (ÙØ§Ø®Ø±)</option>
            </select>
          </div>
          
          <div id="item-accordion">
            <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨Ù†ÙˆØ¯...</p>
          </div>
          
          <button type="button" class="button" onclick="addSelectedItems()">+ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©</button>
        </div>
      </div>

      <div class="form-section">
        <div class="form-section-header"><h2>3. Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø§Ù„Ù…Ø¶Ø§ÙØ© (Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„ØªØ¹Ø¯ÙŠÙ„)</h2></div>
        <div class="form-section-body" style="display: block;">
          <div class="quote-table-wrapper">
            <table class="quote-items-table">
              <thead>
                <tr>
                  <th style="width: 15%;">Ø§Ù„Ù‚Ø³Ù…</th>
                  <th>Ø§Ù„ØµÙ†Ù ÙˆØ§Ù„Ù…ÙˆØ§ØµÙØ§Øª (Ù‚Ø§Ø¨Ù„ Ù„Ù„ØªØ¹Ø¯ÙŠÙ„)</th>
                  <th style="width: 8%;">Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                  <th style="width: 12%;">Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©</th>
                  <th style="width: 12%;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                  <th style="width: 5%;">Ø­Ø°Ù</th>
                </tr>
              </thead>
              <tbody id="quoteItemsBody">
                </tbody>
            </table>
          </div>
        </div>
      </div>

      <div class="form-section">
        <div class="form-section-header"><h2>4. Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ© (ØªØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©)</h2></div>
        <div class="form-section-body">
          <div class="form-group">
            <label for="notes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª (ØªØ¸Ù‡Ø± ØªØ­Øª Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ):</label>
            <textarea id="notes" placeholder="Ø§ÙƒØªØ¨ Ù‡Ù†Ø§ Ø§Ù„Ø´Ø±ÙˆØ· Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©..." onchange="saveDraft()">- Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ØªØ´Ù…Ù„ Ø§Ù„ØªØµÙ…ÙŠÙ…ØŒ Ø§Ù„ØªØµÙ†ÙŠØ¹ØŒ ÙˆØ§Ù„Ù†Ù‚Ù„ ÙˆØ§Ù„ØªØ±ÙƒÙŠØ¨ Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©.
- Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ù„Ø§ ØªØ´Ù…Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ© .
- Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù‚Ø·Ø¹ Ù…ØµÙ†ÙˆØ¹Ø© Ù…Ù† Ø®Ø´Ø¨ Ø¹Ø§Ù„ÙŠ Ø§Ù„Ø¬ÙˆØ¯Ø© Ø¨Ù‚Ø´Ø±Ø© Ø·Ø¨ÙŠØ¹ÙŠØ© ÙˆØ£Ù‚Ù…Ø´Ø© ÙÙ†Ø¯Ù‚ÙŠØ© Ù…Ù‚Ø§ÙˆÙ…Ø© Ù„Ù„Ø¨Ù‚Ø¹.
- Ø§Ù„Ø¹Ø±Ø¶ Ø³Ø§Ø±ÙŠ Ù„Ù…Ø¯Ø© 30 ÙŠÙˆÙ…Ù‹Ø§ Ù…Ù† ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥ØµØ¯Ø§Ø±.</textarea>
          </div>
          <div class="form-group">
            <label for="bankDetails">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¨Ù†Ùƒ (ØªØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ø®Ø§ØªÙ…Ø©):</label>
            <textarea id="bankDetails" placeholder="Ø§ÙƒØªØ¨ Ù‡Ù†Ø§ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¨Ù†ÙƒÙŠ..." onchange="saveDraft()">Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ:
Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨:
Ø§Ù„Ø¢ÙŠØ¨Ø§Ù†:</textarea>
          </div>
        </div>
      </div>
      
      <div class="form-section">
        <div class="form-section-header"><h2>5. Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ ÙˆØ§Ù„Ø®ØµÙ…</h2></div>
        <div class="form-section-body" style="display: block; padding: 20px;">
          <div class="totals-section" style="grid-template-columns: 1fr 1fr;">
            <div class="form-group">
              <label for="discountPercent">Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ… (%):</label>
              <input type="number" id="discountPercent" min="0" max="10" value="0" step="0.5" onchange="updateGrandTotal(); saveDraft();">
            </div>
            <div>
              <div class="totals-display">
                <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±Ø¹ÙŠ:</span>
                <span id="subTotalDisplay">0.00 Ø±ÙŠØ§Ù„</span>
              </div>
              <div class="totals-display">
                <span>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ…:</span>
                <span id="discountAmountDisplay">0.00 Ø±ÙŠØ§Ù„</span>
              </div>
              <hr>
              <div class="totals-display" style="color: var(--ukra-gold); font-size: 1.5rem;">
                <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</span>
                <span id="grandTotalDisplay">0.00 Ø±ÙŠØ§Ù„</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div style="text-align: left; border-top: 1px solid #eee; padding-top: 20px;">
        <button type="button" class="button" onclick="resetForm()">
          ğŸ”„ Ø¹Ø±Ø¶ Ø¬Ø¯ÙŠØ¯
        </button>
        <button type="button" class="button btn-save" onclick="saveQuote()">
          ğŸ’¾ Ø­ÙØ¸ (Ø¬Ø¯ÙŠØ¯/ØªØ¹Ø¯ÙŠÙ„)
        </button>
        <button type="button" class="button btn-preview" onclick="generatePreview()">
          ğŸ“„ Ù…Ø¹Ø§ÙŠÙ†Ø© ÙˆØ·Ø¨Ø§Ø¹Ø©
        </button>
      </div>

    </div>

    <div id="log-view" class="tab-content">
      <h2>Ø³Ø¬Ù„ Ø¹Ø±ÙˆØ¶ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©</h2>
      <p>Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "ØªØ­Ù…ÙŠÙ„ ÙˆØªØ¹Ø¯ÙŠÙ„" Ù„ÙØªØ­ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± ÙÙŠ Ø§Ù„ØªØ¨ÙˆÙŠØ¨ Ø§Ù„Ø£ÙˆÙ„.</p>
      <div class="quote-table-wrapper">
        <table class="log-table">
          <thead>
            <tr>
              <th>Ø±Ù‚Ù… Ø§Ù„Ø¹Ø±Ø¶ (ID)</th>
              <th>Ø§Ø³Ù… Ø§Ù„ÙÙ†Ø¯Ù‚</th>
              <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
              <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
              <th>ØªØ­ÙƒÙ…</th>
            </tr>
          </thead>
          <tbody id="log-table-body">
            </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    // ================== Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© ==================
    
    // !! Ù‡Ø§Ù… Ø¬Ø¯Ø§Ù‹: Ø¶Ø¹ Ù‡Ù†Ø§ Ø±Ø§Ø¨Ø· Ø§Ù„Ù€ Web App Ø§Ù„Ù…Ù†Ø´ÙˆØ± Ù…Ù† Code.gs !!
    const GAS_URL = 'https://script.google.com/macros/s/AKfycbwOgFcX6xeLZJ8LfbiQSizP3-qwZYXq8n_DY4iAoeFTzKDYaR70Fn2yNGfFdkT_9rp_Dw/exec';
    
    // Ù…ØªØºÙŠØ±Ø§Øª Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø¹Ø§Ù…Ø©
    let MASTER_ITEMS_LIST = [];
    let CURRENT_QUOTE = {
      quoteId: null,
      rowIndex: null,
      items: [] // Ù‡Ø°Ø§ Ø³ÙŠØ­Ù…Ù„ Ø§Ù„Ø¨Ù†ÙˆØ¯ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„
    };
    
    // Ø¹Ù†Ø§ØµØ± Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
    const loader = document.getElementById('loader');
    const statusMsg = document.getElementById('statusMessage');
    const hotelNameEl = document.getElementById('hotelName');
    const quoteDateEl = document.getElementById('quoteDate');
    const designDescEl = document.getElementById('designDescription');
    const notesEl = document.getElementById('notes');
    const bankDetailsEl = document.getElementById('bankDetails');
    const discountPercentEl = document.getElementById('discountPercent');
    const quoteItemsBodyEl = document.getElementById('quoteItemsBody');
    const currentQuoteIdEl = document.getElementById('currentQuoteId');
    const currentQuoteRowIndexEl = document.getElementById('currentQuoteRowIndex');
    const coverImageEl = document.getElementById('coverImage'); // Ø¥Ø¶Ø§ÙØ© Ø¹Ù†ØµØ± ØµÙˆØ±Ø© Ø§Ù„ØºÙ„Ø§Ù

    // ================== ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ==================
    
    document.addEventListener('DOMContentLoaded', () => {
      // 1. Ø¶Ø¨Ø· Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ
      quoteDateEl.valueAsDate = new Date();
      
      // 2. Ø¨Ø¯Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
      showLoader(true, 'Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…...');
      fetchMasterItems();
      fetchQuoteLog();
      
      // 3. ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ÙˆØ¯Ø© Ø¥Ù† ÙˆØ¬Ø¯Øª
      loadDraft();
    });

    /**
     * Ø¬Ù„Ø¨ Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù…Ù† Ø§Ù„Ø´ÙŠØª
     */
    function fetchMasterItems() {
      const callbackName = 'jsonp_items_' + Date.now();
      const script = document.createElement('script');
      script.src = `${GAS_URL}?action=getMasterItems&callback=${callbackName}`;
      
      window[callbackName] = (response) => {
        if (response.status === 'success') {
          MASTER_ITEMS_LIST = response.data;
          renderAccordion();
          showLoader(false);
        } else {
          onDataFailed(response.message);
        }
        document.body.removeChild(script);
        delete window[callbackName];
      };
      
      script.onerror = () => onDataFailed('ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø®Ø§Ø¯Ù… Ø§Ù„Ø¨Ù†ÙˆØ¯');
      document.body.appendChild(script);
    }
    
    /**
     * Ø¬Ù„Ø¨ Ø³Ø¬Ù„ Ø§Ù„Ø¹Ø±ÙˆØ¶ Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©
     */
    function fetchQuoteLog() {
      const callbackName = 'jsonp_log_' + Date.now();
      const script = document.createElement('script');
      script.src = `${GAS_URL}?action=getQuotesList&callback=${callbackName}`;
      
      window[callbackName] = (response) => {
        if (response.status === 'success') {
          renderLogTable(response.data);
          showLoader(false);
        } else {
          onDataFailed(response.message);
        }
        document.body.removeChild(script);
        delete window[callbackName];
      };
      
      script.onerror = () => onDataFailed('ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø³Ø¬Ù„ Ø§Ù„Ø¹Ø±ÙˆØ¶');
      document.body.appendChild(script);
    }

    // ================== Ø¯ÙˆØ§Ù„ Ø±Ø³Ù… Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ==================

    /**
     * Ø±Ø³Ù… Ø§Ù„Ø£ÙƒÙˆØ±Ø¯ÙŠÙˆÙ† (ÙˆØ§Ø¬Ù‡Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¨Ù†ÙˆØ¯)
     */
    function renderAccordion() {
      const accordionContainer = document.getElementById('item-accordion');
      accordionContainer.innerHTML = '';
      
      const categories = {};
      MASTER_ITEMS_LIST.forEach(item => {
        if (!categories[item.category]) categories[item.category] = [];
        categories[item.category].push(item);
      });

      for (const category in categories) {
        let itemsHtml = '';
        categories[category].forEach(item => {
          itemsHtml += `
            <label class="item-label">
              <input type="checkbox" class="item-select-checkbox" data-item-id="${item.id}">
              <div>
                <strong>${item.name}</strong><br>
                <small>${item.description}</small>
              </div>
            </label>
          `;
        });
        
        accordionContainer.innerHTML += `
          <div class="accordion-group">
            <div class="accordion-header" onclick="toggleAccordion(this)">
              <span>${category}</span>
              <span>+</span>
            </div>
            <div class="accordion-body">
              <div class="item-selection-grid">${itemsHtml}</div>
            </div>
          </div>
        `;
      }
    }
    
    /**
     * Ø±Ø³Ù… Ø¬Ø¯ÙˆÙ„ Ø³Ø¬Ù„ Ø§Ù„Ø¹Ø±ÙˆØ¶
     */
    function renderLogTable(quotes) {
      const logBody = document.getElementById('log-table-body');
      logBody.innerHTML = '';
      if (quotes.length === 0) {
        logBody.innerHTML = '<tr><td colspan="5">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ø±ÙˆØ¶ Ù…Ø­ÙÙˆØ¸Ø©.</td></tr>';
        return;
      }
      
      quotes.forEach(quote => {
        const row = logBody.insertRow();
        row.innerHTML = `
          <td>${quote.quoteId}</td>
          <td>${quote.hotelName}</td>
          <td>${new Date(quote.quoteDate).toLocaleDateString('ar-SA')}</td>
          <td>${parseFloat(quote.grandTotal).toFixed(2)} Ø±ÙŠØ§Ù„</td>
          <td>
            <button class="button" style="padding: 8px 12px;" onclick="loadQuoteForEdit('${quote.quoteId}')">
              ØªØ­Ù…ÙŠÙ„ ÙˆØªØ¹Ø¯ÙŠÙ„
            </button>
          </td>
        `;
      });
    }

    /**
     * Ø±Ø³Ù… Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨Ù†ÙˆØ¯ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø± (Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø¹Ø±Ø¶ Ù‚Ø¯ÙŠÙ… Ø£Ùˆ Ù…Ø³ÙˆØ¯Ø©)
     */
    function renderQuoteItemsTable(items) {
      quoteItemsBodyEl.innerHTML = '';
      CURRENT_QUOTE.items = []; // ØªÙØ±ÙŠØº Ø§Ù„Ø­Ø§Ù„Ø©
      
      items.forEach(item => {
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ù†Ø¯ Ø¥Ù„Ù‰ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙˆØ¥Ù„Ù‰ Ø§Ù„Ø­Ø§Ù„Ø©
        addQuoteItem(item); 
      });
      updateGrandTotal();
    }
    
    // ================== Ø¯ÙˆØ§Ù„ Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ==================
    
    function switchTab(tabName) {
      document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
      document.querySelectorAll('.tab-button').forEach(el => el.classList.remove('active'));
      
      document.getElementById(`${tabName}-view`).classList.add('active');
      document.getElementById(`tab-${tabName}`).classList.add('active');
    }
    
    function toggleAccordion(headerElement) {
      const body = headerElement.nextElementSibling;
      const indicator = headerElement.querySelector('span:last-child');
      
      if (body.style.display === "block") {
        body.style.display = "none";
        indicator.innerText = "+";
      } else {
        body.style.display = "block";
        indicator.innerText = "-";
      }
    }

    /**
     * Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© Ù…Ù† Ø§Ù„Ø£ÙƒÙˆØ±Ø¯ÙŠÙˆÙ† Ø¥Ù„Ù‰ Ø§Ù„Ø¬Ø¯ÙˆÙ„
     */
    function addSelectedItems() {
      const selectedCheckboxes = document.querySelectorAll('.item-select-checkbox:checked');
      const priceLevel = document.getElementById('priceLevel').value;
      
      selectedCheckboxes.forEach(box => {
        const itemId = box.dataset.itemId;
        const itemData = MASTER_ITEMS_LIST.find(item => item.id === itemId);
        
        if (itemData) {
          const unitPrice = itemData[priceLevel] || 0;
          
          addQuoteItem({
            category: itemData.category,
            name: itemData.name,
            description: itemData.description,
            quantity: 1,
            unitPrice: unitPrice,
            totalPrice: unitPrice
          });
        }
        box.checked = false; // Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ­Ø¯ÙŠØ¯
      });
      
      updateGrandTotal();
      saveDraft(); // Ø­ÙØ¸ Ø§Ù„Ù…Ø³ÙˆØ¯Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
    }
    
    /**
     * Ø¯Ø§Ù„Ø© Ù…Ø±ÙƒØ²ÙŠØ© Ù„Ø¥Ø¶Ø§ÙØ© ØµÙ (Ø³ÙˆØ§Ø¡ Ù…Ù† Ø§Ù„Ø£ÙƒÙˆØ±Ø¯ÙŠÙˆÙ† Ø£Ùˆ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø¹Ø±Ø¶)
     */
    function addQuoteItem(item) {
      // 1. Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ù…ØªØºÙŠØ± Ø§Ù„Ø¹Ø§Ù…
      CURRENT_QUOTE.items.push(item);
      
      // 2. Ø¥Ø¶Ø§ÙØ© Ù„Ù„Ø¬Ø¯ÙˆÙ„ (HTML)
      const row = quoteItemsBodyEl.insertRow();
      row.className = 'quote-item-row';
      const index = CURRENT_QUOTE.items.length - 1; // Ù…Ø¹Ø±Ù Ø§Ù„ØµÙ
      row.dataset.index = index;
      
      row.innerHTML = `
        <td>
          <input type="text" value="${item.category}" onchange="updateItemField(${index}, 'category', this.value)">
        </td>
        <td>
          <strong>${item.name}</strong><br>
          <textarea class="item-desc-input" onchange="updateItemField(${index}, 'description', this.value)">${item.description}</textarea>
        </td>
        <td>
          <input type="number" class="item-qty-input" value="${item.quantity}" min="1" onchange="updateItemField(${index}, 'quantity', this.value)">
        </td>
        <td>
          <input type="number" class="item-unit-price" value="${item.unitPrice}" step="any" onchange="updateItemField(${index}, 'unitPrice', this.value)">
        </td>
        <td>
          <input type="text" class="item-row-total" value="${(item.quantity * item.unitPrice).toFixed(2)}" readonly style="background:#f0f0f0; border:none;">
        </td>
        <td class="no-print">
          <button type="button" class="btn-danger" onclick="deleteRow(this, ${index})">X</button>
        </td>
      `;
    }
    
    // ================== Ø¯ÙˆØ§Ù„ Ø§Ù„Ø­Ø³Ø§Ø¨ ÙˆØ§Ù„ØªØ¹Ø¯ÙŠÙ„ ==================
    
    /**
     * ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ù†Ø¯ ÙÙŠ Ø§Ù„Ù…ØªØºÙŠØ± Ø§Ù„Ø¹Ø§Ù… (Ø¹Ù†Ø¯ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø­Ù‚Ù„)
     */
    function updateItemField(index, fieldName, value) {
      const item = CURRENT_QUOTE.items[index];
      if (item) {
        item[fieldName] = value;
        
        if (fieldName === 'quantity' || fieldName === 'unitPrice') {
          item.totalPrice = (item.quantity * item.unitPrice).toFixed(2);
          const row = quoteItemsBodyEl.querySelector(`tr[data-index="${index}"]`);
          if (row) {
            row.querySelector('.item-row-total').value = item.totalPrice;
          }
          updateGrandTotal();
        }
      }
      saveDraft(); // Ø­ÙØ¸ Ø§Ù„Ù…Ø³ÙˆØ¯Ø© Ø¹Ù†Ø¯ Ø£ÙŠ ØªØ¹Ø¯ÙŠÙ„
    }
    
    /**
     * Ø­Ø°Ù ØµÙ (Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙˆÙ…Ù† Ø§Ù„Ù…ØªØºÙŠØ± Ø§Ù„Ø¹Ø§Ù…)
     */
    function deleteRow(button, index) {
      button.closest('tr').remove();
      CURRENT_QUOTE.items[index] = null; // Ù†Ø¶Ø¹ null Ù„Ù„Ø­ÙØ§Ø¸ Ø¹Ù„Ù‰ Ø§Ù„ÙÙ‡Ø§Ø±Ø³
      updateGrandTotal();
      saveDraft(); // Ø­ÙØ¸ Ø§Ù„Ù…Ø³ÙˆØ¯Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø­Ø°Ù
    }
    
    /**
     * ØªØ­Ø¯ÙŠØ« ÙƒÙ„ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª ÙˆØ§Ù„Ø®ØµÙ…
     */
    function updateGrandTotal() {
      let subTotal = 0;
      
      CURRENT_QUOTE.items.forEach(item => {
        if (item) { // Ù†ØªØ¬Ø§Ù‡Ù„ Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø§Ù„Ù…Ø­Ø°ÙˆÙØ© (null)
          subTotal += parseFloat(item.totalPrice) || 0;
        }
      });
      
      let discountPercent = parseFloat(discountPercentEl.value) || 0;
      if (discountPercent < 0) {
        discountPercent = 0;
        discountPercentEl.value = 0;
      }
      
      let discountAmount = (subTotal * discountPercent) / 100;
      const grandTotal = subTotal - discountAmount;
      
      document.getElementById('subTotalDisplay').innerText = subTotal.toFixed(2) + ' Ø±ÙŠØ§Ù„';
      document.getElementById('discountAmountDisplay').innerText = discountAmount.toFixed(2) + ' Ø±ÙŠØ§Ù„';
      document.getElementById('grandTotalDisplay').innerText = grandTotal.toFixed(2) + ' Ø±ÙŠØ§Ù„';
    }

    /**
     * Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙÙˆØ±Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„
     */
    function resetForm() {
      if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ØŸ Ø³ÙŠØªÙ… Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ø§Ù„Ù…Ø­ÙÙˆØ¸Ø©.')) return;
      
      clearDraft(); // Ø­Ø°Ù Ø§Ù„Ù…Ø³ÙˆØ¯Ø©
      
      CURRENT_QUOTE = { quoteId: null, rowIndex: null, items: [] };
      
      hotelNameEl.value = '';
      quoteDateEl.valueAsDate = new Date();
      coverImageEl.value = '';
      designDescEl.value = 'Ø¥Ø³ØªÙ‚Ø¨Ø§Ù„ ÙˆØºØ±Ù ÙÙ†Ø¯Ù‚ÙŠØ©...';
      notesEl.value = '- Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ù„Ø§ ØªØ´Ù…Ù„...\n- Ø§Ù„Ø¹Ø±Ø¶ Ø³Ø§Ø±ÙŠ...';
      bankDetailsEl.value = 'Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ:...\nØ§Ù„Ø¢ÙŠØ¨Ø§Ù†:...';
      discountPercentEl.value = 0;
      quoteItemsBodyEl.innerHTML = '';
      currentQuoteIdEl.value = '';
      currentQuoteRowIndexEl.value = '';
      
      updateGrandTotal();
      switchTab('creator');
      showStatus('ØªÙ… Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† Ø§Ù„ÙÙˆØ±Ù….', 'success');
    }

    // ================== Ø¯ÙˆØ§Ù„ Ø§Ù„Ø­ÙØ¸ ÙˆØ§Ù„ØªØ­Ù…ÙŠÙ„ (Sheet) ==================
    
    /**
     * ØªØ­Ù…ÙŠÙ„ Ø¹Ø±Ø¶ Ø³Ø¹Ø± Ù‚Ø¯ÙŠÙ… Ù„Ù„ØªØ¹Ø¯ÙŠÙ„
     */
    function loadQuoteForEdit(quoteId) {
      showLoader(true, `Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶ ${quoteId}...`);
      
      const callbackName = 'jsonp_load_' + Date.now();
      const script = document.createElement('script');
      script.src = `${GAS_URL}?action=getQuoteDetails&quoteId=${quoteId}&callback=${callbackName}`;
      
      window[callbackName] = (response) => {
        if (response.status === 'success') {
          const quote = response.data;
          
          hotelNameEl.value = quote.hotelName;
          quoteDateEl.value = new Date(quote.quoteDate).toISOString().split('T')[0];
          coverImageEl.value = quote.coverImage || ''; // ØªØ­Ù…ÙŠÙ„ ØµÙˆØ±Ø© Ø§Ù„ØºÙ„Ø§Ù
          designDescEl.value = quote.designDescription;
          notesEl.value = quote.notes || '';
          bankDetailsEl.value = quote.bankDetails || '';
          discountPercentEl.value = quote.discountPercent || 0;
          
          currentQuoteIdEl.value = quote.quoteId;
          currentQuoteRowIndexEl.value = response.rowIndex;
          
          renderQuoteItemsTable(quote.items);
          
          switchTab('creator');
          showLoader(false);
          showStatus(`ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¹Ø±Ø¶ ${quote.quoteId} Ø¨Ù†Ø¬Ø§Ø­.`, 'success');
          
          // Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†Ø§Ø¬Ø­ØŒ Ù‚Ù… Ø¨Ø­ÙØ¸Ù‡ ÙƒÙ…Ø³ÙˆØ¯Ø©
          saveDraft();
          
        } else {
          onDataFailed(response.message);
        }
        document.body.removeChild(script);
        delete window[callbackName];
      };
      
      script.onerror = () => onDataFailed('ÙØ´Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø³Ø¬Ù„ Ø§Ù„Ø¹Ø±ÙˆØ¶');
      document.body.appendChild(script);
    }
    
    /**
     * Ø­ÙØ¸ (Ø¬Ø¯ÙŠØ¯ Ø£Ùˆ ØªØ­Ø¯ÙŠØ«) ÙÙŠ Google Sheet
     */
    function saveQuote() {
      if (!hotelNameEl.value.trim()) {
        alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„ÙÙ†Ø¯Ù‚.');
        return;
      }
      
      showLoader(true, 'Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø¹Ø±Ø¶ Ø§Ù„Ø³Ø¹Ø±...');
      
      let subTotal = 0;
      const finalItems = [];
      CURRENT_QUOTE.items.forEach(item => {
        if (item) {
          subTotal += parseFloat(item.totalPrice) || 0;
          finalItems.push(item);
        }
      });
      
      const discountPercent = parseFloat(discountPercentEl.value) || 0;
      const discountAmount = (subTotal * discountPercent) / 100;
      const grandTotal = subTotal - discountAmount;
      
      const quoteData = {
        quoteId: currentQuoteIdEl.value || null,
        rowIndex: currentQuoteRowIndexEl.value || null,
        hotelName: hotelNameEl.value,
        quoteDate: quoteDateEl.value,
        coverImage: coverImageEl.value, // Ø­ÙØ¸ ØµÙˆØ±Ø© Ø§Ù„ØºÙ„Ø§Ù
        designDescription: designDescEl.value,
        notes: notesEl.value,
        bankDetails: bankDetailsEl.value,
        discountPercent: discountPercent,
        subTotal: subTotal.toFixed(2),
        discountAmount: discountAmount.toFixed(2),
        grandTotal: grandTotal.toFixed(2),
        items: finalItems
      };
      
      fetch(GAS_URL, {
        method: 'POST',
        body: JSON.stringify(quoteData),
        headers: { 'Content-Type': 'application/json' },
        mode: 'cors' 
      })
      .then(response => response.json())
      .then(result => {
        if (result.status === 'success') {
          showLoader(false);
          showStatus(result.message, 'success');
          clearDraft(); // Ø­Ø°Ù Ø§Ù„Ù…Ø³ÙˆØ¯Ø© Ø¨Ø¹Ø¯ Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ù†Ø§Ø¬Ø­
          fetchQuoteLog(); // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø³Ø¬Ù„
          currentQuoteIdEl.value = result.quoteId;
        } else {
          throw new Error(result.message);
        }
      })
      .catch(error => {
        showLoader(false);
        showStatus('ÙØ´Ù„ Ø§Ù„Ø­ÙØ¸: ' + error.message, 'error');
      });
    }

    // ================== Ø¯ÙˆØ§Ù„ Ø§Ù„Ø­ÙØ¸ Ø§Ù„Ù…Ø¤Ù‚Øª (Draft) ==================

    const DRAFT_KEY = 'ukraQuoteDraft';

    /**
     * ÙŠØ­ÙØ¸ Ø§Ù„Ø­Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù„Ù„ÙÙˆØ±Ù… Ø¨Ø§Ù„ÙƒØ§Ù…Ù„ ÙÙŠ LocalStorage
     */
    function saveDraft() {
      try {
        const draftData = {
          hotelName: hotelNameEl.value,
          quoteDate: quoteDateEl.value,
          coverImage: coverImageEl.value,
          designDescription: designDescEl.value,
          notes: notesEl.value,
          bankDetails: bankDetailsEl.value,
          discountPercent: discountPercentEl.value,
          items: CURRENT_QUOTE.items.filter(item => item) // ÙÙ„ØªØ±Ø© Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø§Ù„Ù…Ø­Ø°ÙˆÙØ©
        };
        localStorage.setItem(DRAFT_KEY, JSON.stringify(draftData));
      } catch (e) {
        console.error('ÙØ´Ù„ Ø­ÙØ¸ Ø§Ù„Ù…Ø³ÙˆØ¯Ø© ÙÙŠ LocalStorage:', e);
      }
    }

    /**
     * ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ÙˆØ¯Ø© Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
     */
    function loadDraft() {
      try {
        const draftJson = localStorage.getItem(DRAFT_KEY);
        if (!draftJson) return;

        if (confirm('ÙˆØ¬Ø¯Ù†Ø§ Ù…Ø³ÙˆØ¯Ø© ØºÙŠØ± Ù…Ø­ÙÙˆØ¸Ø©. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ø³ØªØ¹Ø§Ø¯ØªÙ‡Ø§ØŸ')) {
          const draft = JSON.parse(draftJson);

          hotelNameEl.value = draft.hotelName || '';
          quoteDateEl.value = draft.quoteDate || new Date().toISOString().split('T')[0];
          coverImageEl.value = draft.coverImage || '';
          designDescEl.value = draft.designDescription || '';
          notesEl.value = draft.notes || '';
          bankDetailsEl.value = draft.bankDetails || '';
          discountPercentEl.value = draft.discountPercent || 0;
          
          if (draft.items && draft.items.length > 0) {
            renderQuoteItemsTable(draft.items);
          }
          
          showStatus('ØªÙ… Ø§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø³ÙˆØ¯Ø© Ø¨Ù†Ø¬Ø§Ø­.', 'success');
        }
      } catch (e) {
        console.error('ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ÙˆØ¯Ø© Ù…Ù† LocalStorage:', e);
        localStorage.removeItem(DRAFT_KEY); // Ø­Ø°Ù Ø§Ù„Ù…Ø³ÙˆØ¯Ø© Ø§Ù„ÙØ§Ø³Ø¯Ø©
      }
    }

    /**
     * Ø­Ø°Ù Ø§Ù„Ù…Ø³ÙˆØ¯Ø© (Ø¹Ù†Ø¯ Ø§Ù„Ø­ÙØ¸ Ø£Ùˆ Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø¬Ø¯ÙŠØ¯)
     */
    function clearDraft() {
      try {
        localStorage.removeItem(DRAFT_KEY);
      } catch (e) {
        console.error('ÙØ´Ù„ Ø­Ø°Ù Ø§Ù„Ù…Ø³ÙˆØ¯Ø©:', e);
      }
    }

    // ===============================================
    // == Ø¯Ø§Ù„Ø© Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© (HTML)
    // ===============================================
    
    function generatePreview() {
      if (!hotelNameEl.value.trim()) {
        alert('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„ÙÙ†Ø¯Ù‚ Ù‚Ø¨Ù„ Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©.');
        return;
      }
      
      showLoader(true, 'Ø¬Ø§Ø±ÙŠ ØªØ­Ø¶ÙŠØ± Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©...');
      
      // 1. ØªØ¬Ù…ÙŠØ¹ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
      const data = {
        hotelName: hotelNameEl.value,
        quoteDate: new Date(quoteDateEl.value).toLocaleDateString('ar-SA', { day: '2-digit', month: '2-digit', year: 'numeric' }),
        designDescription: designDescEl.value.replace(/\n/g, '<br>'),
        notes: notesEl.value.replace(/\n/g, '<br>'),
        bankDetails: bankDetailsEl.value.replace(/\n/g, '<br>'),
        discountPercent: parseFloat(discountPercentEl.value).toFixed(2),
        subTotal: document.getElementById('subTotalDisplay').innerText,
        discountAmount: document.getElementById('discountAmountDisplay').innerText,
        grandTotal: document.getElementById('grandTotalDisplay').innerText,
        items: CURRENT_QUOTE.items.filter(item => item),
        coverImage: coverImageEl.value
      };

      // 2. ØªØ¬Ù…ÙŠØ¹ Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø­Ø³Ø¨ Ø§Ù„Ù‚Ø³Ù…
      const itemsByCategory = {};
      data.items.forEach(item => {
        const category = item.category || 'Ù…ØªÙØ±Ù‚Ø§Øª';
        if (!itemsByCategory[category]) {
          itemsByCategory[category] = [];
        }
        itemsByCategory[category].push(item);
      });
      
      // 3. Ø¨Ù†Ø§Ø¡ HTML Ù„Ù„Ø¬Ø¯Ø§ÙˆÙ„ (Ø§Ù„Ù…Ù†Ø·Ù‚ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ù„ØªÙ‚Ø³ÙŠÙ… Ø§Ù„ØµÙØ­Ø§Øª)
      
      // !! ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… Ù„ÙŠÙ†Ø§Ø³Ø¨ ØªØµÙ…ÙŠÙ…Ùƒ (Ù…Ø«Ù„Ø§Ù‹ 15 Ø£Ùˆ 25) !!
      const MAX_ROWS_PER_PAGE = 7; // Ø­Ø¯ Ø§Ù„ØµÙÙˆÙ (Ø´Ø§Ù…Ù„Ø© Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†) Ù„ÙƒÙ„ ØµÙØ­Ø© Ø¬Ø¯ÙˆÙ„
      
      let currentPageNumber = 5; // ØµÙØ­Ø© "Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±" ØªØ¨Ø¯Ø£ Ù…Ù† 5
      let itemsHtml = ''; // Ø³ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ ÙƒÙ„ ØµÙØ­Ø§Øª Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„
      let currentRowCount = 0;

      // Ø¯Ø§Ù„Ø© Ù„ÙØªØ­ ØµÙØ­Ø© Ø¬Ø¯ÙŠØ¯Ø©
      function startNewItemPage(isFirstPage = false) {
        let title = isFirstPage ? 'Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±' : 'Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø£Ø³Ø¹Ø§Ø± (ØªØ§Ø¨Ø¹)';
        // Ù†ÙØªØ­ Ø§Ù„ØµÙØ­Ø©ØŒ ÙˆØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ØŒ ÙˆØ§Ù„Ø¬Ø¯ÙˆÙ„ØŒ ÙˆØ±Ø£Ø³ Ø§Ù„Ø¬Ø¯ÙˆÙ„
        return `
          <div class="page">
            <div class="content-box">
              <h1>${title}</h1>
              <table class="price-table">
                <thead>
                  <tr>
                    <th>Ø§Ù„ØµÙ†Ù (Ø§Ù„ÙˆØµÙ ÙˆØ§Ù„Ù…Ù‚Ø§Ø³)</th>
                    <th class="col-qty">Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                    <th class="col-unit">Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©</th>
                    <th class="col-total">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                  </tr>
                </thead>
                <tbody>
        `; // Ø§ØªØ±Ùƒ <tbody> Ù…ÙØªÙˆØ­Ø§Ù‹
      }

      // Ø¯Ø§Ù„Ø© Ù„Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
      function closeCurrentItemPage(isLastPage = false) {
        let pageHtml = '</tbody></table>'; // Ø£ØºÙ„Ù‚ Ø§Ù„Ø¬Ø¯ÙˆÙ„
        
        // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù‡Ø°Ù‡ Ù‡ÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø© Ù…Ù† Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ØŒ Ø£Ø¶Ù Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª ÙˆØ§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª
        if (isLastPage) {
          pageHtml += `
            <table class="totals-table">
              <tbody>
                <tr>
                  <td>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±Ø¹ÙŠ:</td>
                  <td style="text-align: left;">${data.subTotal}</td>
                </tr>
                <tr>
                  <td>Ù‚ÙŠÙ…Ø© Ø§Ù„Ø®ØµÙ… (${data.discountPercent}%):</td>
                  <td style="text-align: left;">${data.discountAmount}</td>
                </tr>
                <tr class="grand-total">
                  <td>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</td>
                  <td style="text-align: left;">${data.grandTotal}</td>
                </tr>
              </tbody>
            </table>
            <div class="footer-section">
              <h2>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</h2>
              <p>${data.notes}</p>
            </div>
          `;
        }
        
        pageHtml += `<div class="page-footer">ØµÙØ­Ø© ${currentPageNumber}</div>`;
        pageHtml += '</div></div>'; // Ø£ØºÙ„Ù‚ .content-box Ùˆ .page
        currentPageNumber++; // Ø²ÙŠØ§Ø¯Ø© Ø±Ù‚Ù… Ø§Ù„ØµÙØ­Ø© Ù„Ù„ØµÙØ­Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©
        return pageHtml;
      }

      // --- Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù„ÙˆØ¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ---
      
      // 1. ØªØ±ØªÙŠØ¨ Ø§Ù„ÙØ¦Ø§Øª (Categories) Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ categoryOrder
      const categoryOrder = [
        'Ø£Ø«Ø§Ø« Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„', 'Ø£Ø«Ø§Ø« Ø§Ù„Ù…Ø·Ø¹Ù…', 'Ø£Ø«Ø§Ø« Ø§Ù„ØºØ±Ù ÙˆØ§Ù„Ø£Ø¬Ù†Ø­Ø©', 
        'Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ø¬Ù„ÙˆØ³', 'Ù…ÙƒÙ…Ù„Ø§Øª Ø§Ù„ØºØ±ÙØ©', 'Ø§Ù„ÙƒÙ…Ø§Ù„ÙŠØ§Øª'
      ];
      const orderedCategories = [];
      const remainingCategories = { ...itemsByCategory }; // Ø§Ø³ØªÙ†Ø³Ø§Ø® Ø§Ù„ÙƒØ§Ø¦Ù†

      // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„Ù…Ø±ØªØ¨Ø© Ø£ÙˆÙ„Ø§Ù‹
      categoryOrder.forEach(catName => {
        if (remainingCategories[catName]) {
          orderedCategories.push(catName);
          delete remainingCategories[catName]; // Ø§Ù„Ø­Ø°Ù Ù…Ù† Ø§Ù„ÙƒØ§Ø¦Ù† Ø§Ù„Ù…Ø³ØªÙ†Ø³Ø® ÙÙ‚Ø·
        }
      });
      
      // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ÙØ¦Ø§Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©
      for (const catName in remainingCategories) {
        orderedCategories.push(catName);
      }

      // 2. Ø§ÙØªØ­ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰
// --- 2. Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ù„ÙˆØ¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ù„Ø¨Ù†Ø§Ø¡ Ø§Ù„ØµÙØ­Ø§Øª) ---
      
      itemsHtml += startNewItemPage(true); // Ø§ÙØªØ­ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰
      
      for (let i = 0; i < orderedCategories.length; i++) {
        const categoryName = orderedCategories[i];
        const items = itemsByCategory[categoryName];
        let categorySubtotal = 0;

        // --- Ø£. Ø¨Ù†Ø§Ø¡ ÙˆØ¥Ø¶Ø§ÙØ© Ø±Ø£Ø³ Ø§Ù„Ù‚Ø³Ù… ---
        const categoryHeaderHtml = `
          <tr class="category-header-row">
            <th colspan="4" class="category-header">${categoryName}</th>
          </tr>
        `;
        
        // ØªØ­Ù‚Ù‚: Ù‡Ù„ "Ø±Ø£Ø³ Ø§Ù„Ù‚Ø³Ù…" (1 Ø³Ø·Ø±) ÙŠØ­ØªØ§Ø¬ ØµÙØ­Ø© Ø¬Ø¯ÙŠØ¯Ø©ØŸ
        if (currentRowCount + 1 > MAX_ROWS_PER_PAGE && currentRowCount > 0) {
          itemsHtml += closeCurrentItemPage(false); // Ø£ØºÙ„Ù‚ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
          itemsHtml += startNewItemPage(false); // Ø§Ø¨Ø¯Ø£ ØµÙØ­Ø© Ø¬Ø¯ÙŠØ¯Ø© (Ù…Ø¹ <thead>)
          currentRowCount = 0;
        }
        itemsHtml += categoryHeaderHtml;
        currentRowCount += 1; // Ø¥Ø¶Ø§ÙØ© 1 (Ø±Ø£Ø³ Ø§Ù„Ù‚Ø³Ù…) Ù„Ù„Ø¹Ø¯Ø§Ø¯

        // --- Ø¨. Ø¥Ø¶Ø§ÙØ© ØµÙÙˆÙ Ø§Ù„Ø¨Ù†ÙˆØ¯ (Ù…Ø¹ Ø§Ù„ØªÙ‚Ø³ÙŠÙ…) ---
        for (let j = 0; j < items.length; j++) {
          const item = items[j];
          const itemTotal = parseFloat(item.totalPrice) || 0;
          categorySubtotal += itemTotal;
          
          const itemRowHtml = `
            <tr class="item-row">
              <td><strong>${item.name}</strong><br><small style="color: #555;">${item.description}</small></td>
              <td class="col-qty">${item.quantity}</td>
              <td class="col-unit">${parseFloat(item.unitPrice).toFixed(2)}</td>
              <td class="col-total">${itemTotal.toFixed(2)}</td>
            </tr>
          `;

          // ØªØ­Ù‚Ù‚: Ù‡Ù„ "ØµÙ Ø§Ù„Ø¨Ù†Ø¯" (1 Ø³Ø·Ø±) ÙŠØ­ØªØ§Ø¬ ØµÙØ­Ø© Ø¬Ø¯ÙŠØ¯Ø©ØŸ
          if (currentRowCount + 1 > MAX_ROWS_PER_PAGE) {
            itemsHtml += closeCurrentItemPage(false); // Ø£ØºÙ„Ù‚ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
            itemsHtml += startNewItemPage(false); // Ø§Ø¨Ø¯Ø£ ØµÙØ­Ø© Ø¬Ø¯ÙŠØ¯Ø© (Ù…Ø¹ <thead>)
            currentRowCount = 0;
            
            // !! Ù‡Ø§Ù…: Ø£Ø¹Ø¯ Ø¥Ø¶Ø§ÙØ© Ø±Ø£Ø³ Ø§Ù„Ù‚Ø³Ù… ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© !!
            itemsHtml += categoryHeaderHtml; 
            currentRowCount += 1;
          }
          
          itemsHtml += itemRowHtml;
          currentRowCount += 1; // Ø¥Ø¶Ø§ÙØ© 1 (ØµÙ Ø§Ù„Ø¨Ù†Ø¯) Ù„Ù„Ø¹Ø¯Ø§Ø¯
        }

        // --- Ø¬. Ø¨Ù†Ø§Ø¡ ÙˆØ¥Ø¶Ø§ÙØ© ØµÙ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±Ø¹ÙŠ ---
        const subtotalRowHtml = `
          <tr class="subtotal-row">
            <td colspan="3">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙØ±Ø¹ÙŠ Ù„Ù‚Ø³Ù…: ${categoryName}</td>
            <td>${categorySubtotal.toFixed(2)}</td>
          </tr>
        `;

        // ØªØ­Ù‚Ù‚: Ù‡Ù„ "ØµÙ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ" (1 Ø³Ø·Ø±) ÙŠØ­ØªØ§Ø¬ ØµÙØ­Ø© Ø¬Ø¯ÙŠØ¯Ø©ØŸ
        if (currentRowCount + 1 > MAX_ROWS_PER_PAGE) {
          itemsHtml += closeCurrentItemPage(false); // Ø£ØºÙ„Ù‚ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø©
          itemsHtml += startNewItemPage(false); // Ø§Ø¨Ø¯Ø£ ØµÙØ­Ø© Ø¬Ø¯ÙŠØ¯Ø© (Ù…Ø¹ <thead>)
          currentRowCount = 0;
          // (Ù„Ø§ Ø¯Ø§Ø¹ÙŠ Ù„Ø±Ø£Ø³ Ø§Ù„Ù‚Ø³Ù… Ù‡Ù†Ø§ØŒ ÙÙ‚Ø· Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ)
        }
        
        itemsHtml += subtotalRowHtml;
        currentRowCount += 1; // Ø¥Ø¶Ø§ÙØ© 1 (ØµÙ Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ) Ù„Ù„Ø¹Ø¯Ø§Ø¯
      }

      // 3. Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ù„ÙˆØ¨ØŒ Ø£ØºÙ„Ù‚ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø£Ø®ÙŠØ±Ø©
      itemsHtml += closeCurrentItemPage(true); // true = Ø£Ø¶Ù Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ§Øª Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©
      
      // --- Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„ÙˆØ¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ Ø§Ù„Ø¬Ø¯ÙŠØ¯ ---
      // --- Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„ÙˆØ¨ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ ---

      // 4. Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù€ HTML Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©
      const previewHtml = `
        <!DOCTYPE html>
        <html lang="ar" dir="rtl">
        <head>
          <meta charset="UTF-8">
          <title>Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¹Ø±Ø¶ Ø³Ø¹Ø± - ${data.hotelName}</title>
          <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap" rel="stylesheet">
          <style>
            /* --- 1. Ø®Ù„ÙÙŠØ© Ø§Ù„Ù…ØªØµÙØ­ (Ø®Ù„ÙÙŠØ© "ØµÙØ­Ø© Ø§Ù„Ø¹Ø±Ø¶") --- */
            body {
              font-family: 'Cairo', sans-serif;
              background-color: #ffffff; /* --- Ø£Ø¨ÙŠØ¶ Ø¹Ø§Ø¯ÙŠ --- */
              margin: 0;
              padding: 0;
            }
            
            /* --- 2. Ù‡ÙŠÙƒÙ„ Ø§Ù„ØµÙØ­Ø© (ÙˆØ±Ù‚Ø© A4) --- */
            .page {
              width: 210mm;
              height: 297mm; /* --- Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø¯Ù‚ÙŠÙ‚ Ù„Ù€ A4 --- */
              margin: 15px auto;
              box-shadow: 0 5px 15px rgba(0,0,0,0.2);
              page-break-after: always;
              position: relative;
              box-sizing: border-box;
              background-color: #F7F3F0; /* --- Ø¨ÙŠØ¬/ØªØ§Ù† ÙØ§ØªØ­ Ø¬Ø¯Ø§Ù‹ --- */
              padding: 15mm; 
            }
            
            /* --- 3. ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ (Ø§Ù„ØµÙ†Ø¯ÙˆÙ‚ Ø§Ù„Ø£Ø¨ÙŠØ¶ Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠ) --- */
            .content-box {
              background-color: #ffffff; /* --- ØµÙ†Ø¯ÙˆÙ‚ Ø£Ø¨ÙŠØ¶ --- */
              border-radius: 15px; /* --- Ø­ÙˆØ§Ù Ø¯Ø§Ø¦Ø±ÙŠØ© --- */
              padding: 20mm;
              width: 100%;
              height: 100%;
              box-sizing: border-box;
              position: relative;
              overflow: hidden;
            }

            /* --- 4. ØªØ®ØµÙŠØµ ØµÙØ­Ø© Ø§Ù„ØºÙ„Ø§Ù (Page 1) --- */
            .cover-page {
              background-color: #c19577; /* --- Ù„ÙˆÙ† Ø§Ù„Ù„ÙˆØ¬Ùˆ Ø§Ù„Ø¨Ù†ÙŠ --- */
              background-size: cover;
              background-position: center;
              background-repeat: no-repeat;
              min-height: 100%;
              color: #ffffff;
              padding: 0;
              display: flex;
              flex-direction: column;
              justify-content: space-between;
              align-items: center;
            }
            .cover-page::before {
              content: '';
              position: absolute;
              top: 0; left: 0; right: 0; bottom: 0;
              background: rgba(0, 0, 0, 0.4);
              z-index: 1;
            }
            .cover-page > * {
              position: relative;
              z-index: 2;
            }
            .cover-logo-ukra {
              text-align: center;
            }
            .cover-footer {
              padding-bottom: 20mm;
              font-size: 12pt;
              color: #ffffff;
            }

            /* --- 5. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© --- */
            @media print {
              body, .page {
                -webkit-print-color-adjust: exact !important;
                print-color-adjust: exact !important;
              }
              body {
                background-color: #ffffff !important;
              }
              .page {
                margin: 0;
                box-shadow: none;
                padding: 15mm;
                height: auto;
                background-color: #c0ab9c !important;
              }
              .content-box {
                border-radius: 0;
                /* --- Ø¥ØµÙ„Ø§Ø­ Ø§Ù„ÙØ±Ø§Øº Ø§Ù„Ø£Ø¨ÙŠØ¶ --- */
                min-height: 267mm; /* 297mm - 15mm - 15mm */
                background-color: #e7e9d9 !important;
              }
              .cover-page {
                min-height: 297mm;
                padding: 0;
                background-color: #c19577 !important;
              }
            }

            /* --- 6. ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ù…Ø­ØªÙˆÙ‰ (Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†ØŒ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ØŒ ...) --- */
            h1 {
              font-size: 24pt;
              color: #333;
              border-bottom: 2px solid #333;
              padding-bottom: 10px;
              margin-top: 0;
              margin-bottom: 30px;
              page-break-after: avoid;
            }
            h2 {
              font-size: 16pt;
              color: #C9A86A;
              margin-top: 25px;
              margin-bottom: 10px;
              page-break-after: avoid;
            }
            p, li {
              font-size: 11pt;
              line-height: 1.6;
              color: #222;
            }
            ul {
              padding-right: 20px;
            }

            /* --- Ø±Ù‚Ù… Ø§Ù„ØµÙØ­Ø© (Ø¯Ø§Ø®Ù„ content-box) --- */
            .page-footer {
              position: absolute;
              bottom: 15mm;
              left: 0;
              width: 100%;
              text-align: center;
              color: #999;
              font-size: 10pt;
            }

            /* --- ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ (Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø§Ù‚ØªØµØ§Øµ) --- */
            .price-table {
              width: 100%;
              border-collapse: collapse;
              margin-top: 15px;
              font-size: 9pt;
              page-break-inside: auto;
            }
            .price-table th, .price-table td {
              border: 1px solid #999;
              padding: 8px;
              text-align: right;
            }
            .price-table th {
              background: #f4f4f4;
              font-weight: bold;
            }
            .price-table thead {
              display: table-header-group; /* ØªÙƒØ±Ø§Ø± Ø±Ø£Ø³ Ø§Ù„Ø¬Ø¯ÙˆÙ„ */
            }
            .price-table tr.item-row,
            .price-table tr.subtotal-row,
            .price-table tr.category-header-row {
              page-break-inside: avoid; /* Ù…Ù†Ø¹ Ø§Ù†Ù‚Ø³Ø§Ù… Ø§Ù„ØµÙ */
            }
            .price-table .category-header {
              background: #f0f0f0;
              font-size: 12pt;
              font-weight: bold;
              color: #333;
              padding-top: 15px;
            }
            .price-table .subtotal-row td {
              font-weight: bold;
              background: #f9f9f9;
            }
            .price-table .col-qty { width: 8%; }
            .price-table .col-unit { width: 15%; }
            .price-table .col-total { width: 15%; }

            .totals-table {
              width: 50%;
              margin-right: 0;
              margin-left: auto;
              margin-top: 25px;
              font-size: 11pt;
              border-collapse: collapse;
              page-break-inside: avoid;
            }
            .totals-table td {
              padding: 10px;
              border-bottom: 1px dashed #ccc;
            }
            .totals-table .grand-total td {
              font-size: 1.3rem;
              font-weight: bold;
              color: #C9A86A;
              border-top: 2px solid #333;
              border-bottom: none;
            }
            .footer-section {
              margin-top: 30px;
              padding-top: 15px;
              border-top: 1px solid #eee;
              font-size: 10pt;
              white-space: pre-wrap;
            }
            .timeline-table {
              width: 100%;
              border-collapse: collapse;
              margin-top: 20px;
              font-size: 11pt;
              page-break-inside: avoid;
            }
            .timeline-table th, .timeline-table td {
              border: 1px solid #999;
              padding: 12px;
            }
            .timeline-table th { background: #f4f4f4; }
            .timeline-table .total-row {
              font-weight: bold;
              background: #f9f9f9;
            }
            
            /* ØªÙ†Ø³ÙŠÙ‚Ø§Øª Ø®Ø§ØµØ© Ø¨Ø§Ù„Ù„ÙˆØ¬Ùˆ ÙˆØ§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ† ÙÙŠ Ø§Ù„ØºÙ„Ø§Ù */
            .cover-title-box { text-align: center; }
            .cover-title-box h1 {
              font-size: 48pt;
              border: none;
              margin: 0;
              color: #C9A86A;
            }
            .cover-title-box h2 {
              font-size: 20pt;
              color: #ffffff;
              margin: 10px 0;
            }
          </style>
        </head>
        <body>
        
          <div class="page cover-page" style="background-image: url('${data.coverImage}');">
            <div class="cover-logo-ukra">
              <img src="UKRA_Logo.png" alt="UKRA Logo" style="width: 200px; max-width: 100%;">
            </div>
            
            <div class="cover-title-box">
              <h1>Ø¹Ø±Ø¶ Ø³Ø¹Ø±</h1>
              <h2>Hotel Supplies</h2>
              <h2 style="font-size: 1.5rem; margin-top: 15px;">${data.hotelName}</h2>
            </div>
            
            <div class="cover-footer">
              Ø§Ù„ØªØ§Ø±ÙŠØ®: ${data.quoteDate}
            </div>
          </div>
          
          <div class="page">
            <div class="content-box">
              <h1>ØªÙ‚Ø¯ÙŠÙ…</h1>
              <p style="font-weight: bold;">Ø¥Ù„Ù‰ Ø§Ù„Ø³ÙŠØ¯ / Ø§Ù„Ø³ÙŠØ¯Ø© : ${data.hotelName}, Ø§Ù„Ù…Ø­ØªØ±Ù…ÙŠÙ†,,,</p>
              <p>Ø§Ù„Ø³Ù„Ø§Ù… Ø¹Ù„ÙŠÙƒÙ… ÙˆØ±Ø­Ù…Ø© Ø§Ù„Ù„Ù‡ ÙˆØ¨Ø±ÙƒØ§ØªÙ‡</p>
              <p>ÙŠÙØ³Ø¹Ø¯Ù†Ø§ ÙÙŠ Ø£ÙˆÙƒØ±Ù‡ UKRA Ø£Ù† Ù†ØªÙ‚Ø¯Ù… Ø¥Ù„ÙŠÙƒÙ… Ø¨Ø¹Ø±Ø¶Ù†Ø§ Ù„ØªØµÙ…ÙŠÙ… ÙˆØªØµÙ†ÙŠØ¹ ÙˆØªÙˆØ±ÙŠØ¯ ØºØ±Ù Ø§Ù„Ù†ÙˆÙ… Ø§Ù„ÙÙ†Ø¯Ù‚ÙŠØ© ÙˆÙÙ‚ Ø£Ø¹Ù„Ù‰ Ù…Ø¹Ø§ÙŠÙŠØ± Ø§Ù„Ø¬ÙˆØ¯Ø© ÙˆØ§Ù„Ø¯Ù‚Ø© ÙÙŠ Ø§Ù„ØªÙØ§ØµÙŠÙ„.</p>
              <p>ØªØªÙ…ÙŠØ² Ø´Ø±ÙƒØªÙ†Ø§ Ø¨Ø®Ø¨Ø±Ø© ÙˆØ§Ø³Ø¹Ø© ÙÙŠ Ù…Ø¬Ø§Ù„ ØªØµÙ…ÙŠÙ… ÙˆØªÙ†ÙÙŠØ° Ø§Ù„Ø£Ø«Ø§Ø« Ø§Ù„ÙÙ†Ø¯Ù‚ÙŠØŒ Ø¨Ù…Ø§ ÙÙŠ Ø°Ù„Ùƒ ØºØ±Ù Ø§Ù„Ù†Ø²Ù„Ø§Ø¡ØŒ Ø§Ù„Ø£Ø¬Ù†Ø­Ø©ØŒ ÙˆØ§Ù„Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ø¹Ø§Ù…Ø©ØŒ Ù…Ø¹ Ø§Ù„Ø­Ø±Øµ Ø¹Ù„Ù‰ Ø§Ù„Ù…Ø²Ø¬ Ø¨ÙŠÙ† Ø§Ù„Ø£Ù†Ø§Ù‚Ø© ÙˆØ§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¨Ù…Ø§ ÙŠØªÙ†Ø§Ø³Ø¨ Ù…Ø¹ Ø·Ø§Ø¨Ø¹ ÙƒÙ„ Ù…Ù†Ø´Ø£Ø© ÙÙ†Ø¯Ù‚ÙŠØ©.</p>
              <p>ÙŠÙ‡Ø¯Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø±Ø¶ Ø¥Ù„Ù‰ ØªÙ‚Ø¯ÙŠÙ… Ø­Ù„ Ù…ØªÙƒØ§Ù…Ù„ Ù„ØªØ£Ø«ÙŠØ« ØºØ±Ù Ø§Ù„Ù†ÙˆÙ… Ø§Ù„ÙÙ†Ø¯Ù‚ÙŠØ© Ø¨Ù…Ø³ØªÙˆÙ‰ ØªÙƒÙ„ÙØ© Ù…ØªÙˆØ³Ø· ÙˆØ¬ÙˆØ¯Ø© Ø¹Ø§Ù„ÙŠØ©ØŒ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙˆØ§Ø¯ Ù…Ø®ØªØ§Ø±Ø© Ø¨Ø¹Ù†Ø§ÙŠØ© ÙˆØ£Ù„ÙˆØ§Ù† Ù…ØªÙˆØ§Ø²Ù†Ø© ØªØ®Ù„Ù‚ Ø£Ø¬ÙˆØ§Ø¡ Ø±Ø§Ø­Ø© ÙˆÙØ®Ø§Ù…Ø©.</p>
              <p>Ù†ØªØ·Ù„Ø¹ Ø¥Ù„Ù‰ ÙØ±ØµØ© Ø§Ù„ØªØ¹Ø§ÙˆÙ† Ù…Ø¹ÙƒÙ… Ù„ØªØ­Ù‚ÙŠÙ‚ Ø±Ø¤ÙŠØ© ÙÙ†Ø¯Ù‚ÙƒÙ… Ø§Ù„Ù…Ù…ÙŠØ²Ø© Ø¨Ø£Ø«Ø§Ø« Ø£Ù†ÙŠÙ‚ ÙŠØ¯ÙˆÙ… Ø·ÙˆÙŠÙ„Ø§Ù‹.</p>
              
              <p style="margin-top: 40px; font-weight: bold;">
                ÙˆØªÙØ¶Ù„ÙˆØ§ Ø¨Ù‚Ø¨ÙˆÙ„ ÙØ§Ø¦Ù‚ Ø§Ù„Ø§Ø­ØªØ±Ø§Ù…<br>
                ÙØ±ÙŠÙ‚ Ù…Ø¨ÙŠØ¹Ø§Øª Ø£ÙˆÙƒØ±Ù‡ | UKRA<br>
                sales@ukra.sa
              </p>
              <div class="page-footer">ØµÙØ­Ø© 2</div>
            </div>
          </div>
          
          <div class="page">
            <div class="content-box">
              <h1>Ø¹Ù† Ø§Ù„Ø´Ø±ÙƒØ©</h1>
              <p>ØªØ£Ø³Ø³Øª Ø£ÙˆÙƒØ±Ù‡ | UKRA Ù…Ù†Ø° 2010 Ù„ØªÙƒÙˆÙ† Ù…Ù† Ø£Ø¨Ø±Ø² Ø§Ù„Ø´Ø±ÙƒØ§Øª Ø§Ù„Ù…ØªØ®ØµØµØ© ÙÙŠ ØªØµÙ…ÙŠÙ… ÙˆØªØµÙ†ÙŠØ¹ Ø§Ù„Ø£Ø«Ø§Ø« Ø§Ù„ÙÙ†Ø¯Ù‚ÙŠ ÙˆØ§Ù„Ù…ÙƒØªØ¨ÙŠ ÙˆØ§Ù„Ø³ÙƒÙ†ÙŠØŒ ÙˆØ§Ø¶Ø¹Ø© Ù†ØµØ¨ Ø£Ø¹ÙŠÙ†Ù‡Ø§ ØªØ­Ù‚ÙŠÙ‚ Ø§Ù„ØªÙˆØ§Ø²Ù† Ø¨ÙŠÙ† Ø§Ù„Ø¬Ù…Ø§Ù„ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ ÙˆØ§Ù„Ø¬ÙˆØ¯Ø© Ø§Ù„Ø¹Ø§Ù„ÙŠØ©.</p>
              <h2>Ø§Ù„Ø±Ø¤ÙŠØ© :</h2>
              <p>Ø£Ù† Ù†ÙƒÙˆÙ† Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø£ÙˆÙ„ Ù„Ù„ÙÙ†Ø§Ø¯Ù‚ ÙˆØ§Ù„Ù…Ø´Ø±ÙˆØ¹Ø§Øª Ø§Ù„Ø¹Ù‚Ø§Ø±ÙŠØ© ÙÙŠ Ù…Ø¬Ø§Ù„ ØªØ£Ø«ÙŠØ« Ø§Ù„Ù…Ø³Ø§Ø­Ø§Øª Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©.</p>
              <h2>Ø§Ù„Ø±Ø³Ø§Ù„Ø©:</h2>
              <p>ØªÙ‚Ø¯ÙŠÙ… Ù…Ù†ØªØ¬Ø§Øª ØªØ¬Ù…Ø¹ Ø¨ÙŠÙ† Ø§Ù„ØªØµÙ…ÙŠÙ… Ø§Ù„Ø¹ØµØ±ÙŠ ÙˆØ§Ù„Ø¬ÙˆØ¯Ø© Ø§Ù„ÙØ§Ø¦Ù‚Ø©ØŒ Ù…Ø¹ Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯ ÙˆØ§Ù„Ø¯Ù‚Ø© ÙÙŠ Ø§Ù„ØªÙ†ÙÙŠØ°.</p>
              <h2>Ø§Ù„Ø®Ø¨Ø±Ø§Øª ÙˆØ§Ù„Ø¥Ù†Ø¬Ø§Ø²Ø§Øª :</h2>
              <p>Ù‚Ù…Ù†Ø§ Ø¨ØªÙ†ÙÙŠØ° Ù…Ø´Ø§Ø±ÙŠØ¹ Ù…ØªØ¹Ø¯Ø¯Ø© Ù„ÙÙ†Ø§Ø¯Ù‚ Ø±Ø§Ù‚ÙŠØ© ÙˆØ´Ù‚Ù‚ ÙÙ†Ø¯Ù‚ÙŠØ©ØŒ Ù…Ø¹ ØªÙ‚Ø¯ÙŠÙ… ØªØµØ§Ù…ÙŠÙ… Ù…Ø®ØµØµØ© ØªÙ„Ø§Ø¦Ù… Ù‡ÙˆÙŠØ© ÙƒÙ„ Ø¹Ù…ÙŠÙ„.</p>
              <h2>Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© :</h2>
              <ul>
                <li>Ø§Ù„Ø¬ÙˆØ¯Ø© Ø£ÙˆÙ„Ø§Ù‹</li>
                <li>Ø§Ù„Ø§Ø¨ØªÙƒØ§Ø± ÙÙŠ Ø§Ù„ØªØµÙ…ÙŠÙ…</li>
                <li>Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠØ© ÙÙŠ Ø§Ù„ØªÙ†ÙÙŠØ°</li>
                <li>Ø§Ù„Ø§Ù„ØªØ²Ø§Ù… Ø¨Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</li>
              </ul>
              <h2>ÙØ±ÙŠÙ‚ Ø§Ù„Ø¹Ù…Ù„ :</h2>
              <p>ÙŠØ¶Ù… ÙØ±ÙŠÙ‚Ù†Ø§ Ù†Ø®Ø¨Ø© Ù…Ù† Ø§Ù„Ù…ØµÙ…Ù…ÙŠÙ† ÙˆØ§Ù„Ù…Ù‡Ù†Ø¯Ø³ÙŠÙ† ÙˆØ§Ù„ÙÙ†ÙŠÙŠÙ† Ø°ÙˆÙŠ Ø§Ù„Ø®Ø¨Ø±Ø© Ø§Ù„Ø¹Ø§Ù„ÙŠØ© ÙÙŠ Ù…Ø¬Ø§Ù„ Ø§Ù„Ø£Ø«Ø§Ø« Ø§Ù„ÙÙ†Ø¯Ù‚ÙŠ.</p>
              <div class="page-footer">ØµÙØ­Ø© 3</div>
            </div>
          </div>
          
          <div class="page">
            <div class="content-box">
              <h1>ÙˆØµÙ Ø§Ù„ØªØµÙ…ÙŠÙ…</h1>
              <p style="font-size: 12pt; line-height: 1.7;">${data.designDescription}</p>
              <h2>Ø§Ù„Ù…ÙˆØ§Ø¯ ÙˆØ§Ù„Ø¬ÙˆØ¯Ø©</h2>
              <ul>
                <li><b>Ø§Ù„Ø£Ø®Ø´Ø§Ø¨:</b> Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø®Ø´Ø¨ Ø§Ù„Ù…ØªÙŠÙ† ÙˆØ§Ù„Ø®Ø´Ø¨ Ø§Ù„Ù…Ø·Ù„ÙŠ ÙÙŠ Ù…Ø¹Ø¸Ù… Ø§Ù„Ù‚Ø·Ø¹ ÙƒØ§Ù„Ù‡ÙŠØ§ÙƒÙ„ Ø§Ù„Ø·Ø§ÙˆÙ„Ø§ØªØŒ ÙˆØ§Ù„Ø¯ÙˆØ§Ù„ÙŠØ¨.</li>
                <li><b>Ø§Ù„Ø£Ù‚Ù…Ø´Ø©:</b> Ø§Ù„Ø§Ø¹ØªÙ…Ø§Ø¯ Ø¹Ù„Ù‰ Ù‚Ù…Ø§Ø´ Ø§Ù„Ù…Ø®Ù…Ù„ Ø§Ù„ÙØ§Ø®Ø± ÙÙŠ ØªÙ†Ø¬ÙŠØ¯ Ø§Ù„ÙƒÙ†Ø¨ ÙˆØ§Ù„ÙƒØ±Ø§Ø³ÙŠØŒ Ù…Ù…Ø§ ÙŠÙ…Ù†Ø­ Ø¥Ø­Ø³Ø§Ø³Ù‹Ø§ Ø¨Ø§Ù„Ø±Ø§Ø­Ø© ÙˆØ§Ù„ÙØ®Ø§Ù…Ø©.</li>
                <li><b>Ø§Ù„Ù…Ø¹Ø§Ø¯Ù†:</b> Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø¹Ø¯Ù† ÙÙŠ Ø£Ø±Ø¬Ù„ ÙƒØ±Ø§Ø³ÙŠ ÙˆØ·Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ù…Ø·Ø¹Ù… Ù„Ø¶Ù…Ø§Ù† Ø§Ù„Ø«Ø¨Ø§Øª ÙˆØ§Ù„Ù…ØªØ§Ù†Ø©.</li>
                <li><b>Ø§Ù„Ù…ÙˆØ§Ø¯ Ø§Ù„Ø£Ø®Ø±Ù‰:</b> Ø¯Ù…Ø¬ Ø£Ø³Ø·Ø­ Ø§Ù„Ø±Ø®Ø§Ù… ÙÙŠ Ù‚Ø·Ø¹ Ù…Ù…ÙŠØ²Ø© Ø¨Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ØŒ Ø¨Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø²Ø¬Ø§Ø¬ ÙˆØ§Ù„ÙÙŠØ¨Ø±Ø¬Ù„Ø§Ø³.</li>
                <li><b>Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„ØªØ®ØµÙŠØµ:</b> Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ§ØµÙØ§ØªØŒ ÙŠÙ…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ø³Ø§Øª Ø£Ùˆ Ø§Ù„ØªØ´Ø·ÙŠØ¨Ø§Øª Ù„ØªØªÙ†Ø§Ø³Ø¨ Ø¨Ø´ÙƒÙ„ Ø¯Ù‚ÙŠÙ‚ Ù…Ø¹ Ù…ØªØ·Ù„Ø¨Ø§Øª ÙƒÙ„ Ù…Ø³Ø§Ø­Ø© ÙÙŠ Ø§Ù„ÙÙ†Ø¯Ù‚.</li>
              </ul>
              <div class="page-footer">ØµÙØ­Ø© 4</div>
            </div>
          </div>
          
          
          ${itemsHtml}
          
          <div class="page">
            <div class="content-box">
              <h1>Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ ÙˆØ´Ø±ÙˆØ· Ø§Ù„Ø¹Ù‚Ø¯</h1>
              <h2>Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø²Ù…Ù†ÙŠ</h2>
              <table class="timeline-table">
                <thead>
                  <tr><th>Ø§Ù„Ù…Ø±Ø­Ù„Ø©</th><th>Ø§Ù„Ù…Ø¯Ø©</th><th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th></tr>
                </thead>
                <tbody>
                  <tr><td>ØªØµÙ…ÙŠÙ… ÙˆØªÙ†ÙÙŠØ° Ø§Ù„Ø¹ÙŠÙ†Ø§Øª</td><td>10 Ø£ÙŠØ§Ù…</td><td>Ø¨Ø¹Ø¯ Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ø¹Ø±Ø¶</td></tr>
                  <tr><td>Ø§Ù„ØªØµÙ†ÙŠØ¹ Ø§Ù„ÙƒØ§Ù…Ù„</td><td>30 ÙŠÙˆÙ…Ø§</td><td>ÙÙŠ Ù…ØµÙ†Ø¹Ù†Ø§ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</td></tr>
                  <tr><td>Ø§Ù„Ù†Ù‚Ù„ ÙˆØ§Ù„ØªØ±ÙƒÙŠØ¨</td><td>5 Ø£ÙŠØ§Ù…</td><td>ÙÙŠ Ù…ÙˆÙ‚Ø¹ Ø§Ù„ÙÙ†Ø¯Ù‚</td></tr>
                  <tr class="total-row"><td>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¯Ø© Ø§Ù„ØªÙ‚Ø¯ÙŠØ±ÙŠØ©</td><td>45 ÙŠÙˆÙ…Ø§ Ø¹Ù…Ù„</td><td></td></tr>
                </tbody>
              </table>
              <h2>Ø§Ù„Ø¶Ù…Ø§Ù†:</h2>
              <p>Ø¶Ù…Ø§Ù† Ù„Ù…Ø¯Ø© 5 Ø³Ù†ÙˆØ§Øª ÙƒØ§Ù…Ù„Ø© Ø¶Ø¯ Ø¹ÙŠÙˆØ¨ Ø§Ù„ØªØµÙ†ÙŠØ¹ØŒ ÙŠØ´Ù…Ù„ Ø§Ù„ØµÙŠØ§Ù†Ø© ÙˆØ§Ù„Ø¥ØµÙ„Ø§Ø­ Ø¯ÙˆÙ† ØªÙƒÙ„ÙØ©. Ù„Ø§ ÙŠØ´Ù…Ù„ Ø³ÙˆØ¡ Ø§Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù….</p>
              <h2>ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø¹Ø±Ø¶:</h2>
              <p>Ù‡Ø°Ø§ Ø§Ù„Ø¹Ø±Ø¶ Ø³Ø§Ø±ÙŠ Ù„Ù…Ø¯Ø© 30 ÙŠÙˆÙ…Ø§ Ù…Ù† ØªØ§Ø±ÙŠØ® ØµØ¯ÙˆØ±Ù‡.</p>
              <div class="page-footer">ØµÙØ­Ø© ${currentPageNumber}</div>
            </div>
          </div>

          <div class="page">
            <div class="content-box">
              <h1>Ø§Ù„Ø®Ø§ØªÙ…Ø©</h1>
              <p>Ù†Ø´ÙƒØ±ÙƒÙ… Ø¹Ù„Ù‰ ÙˆÙ‚ØªÙƒÙ… ÙˆØ§Ù‡ØªÙ…Ø§Ù…ÙƒÙ…ØŒ ÙˆÙ†Ø­Ù† Ø¹Ù„Ù‰ Ø§Ø³ØªØ¹Ø¯Ø§Ø¯ ØªØ§Ù… Ù„Ù…Ù†Ø§Ù‚Ø´Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø¨Ø§Ù„ØªÙØµÙŠÙ„ ÙˆØ§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø¹Ù„Ù‰ Ø£ÙŠ Ø§Ø³ØªÙØ³Ø§Ø±Ø§Øª.</p>
              <h2>Ù„Ù„ØªÙˆØ§ØµÙ„</h2>
              <ul>
                <li>Ø§Ù„Ù‡Ø§ØªÙ: 0544976640</li>
                <li>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ: sales@ukra.sa</li>
                <li>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: Ø³Ù„Ø·Ø§Ù†Ø© - Ø§Ù„Ù…Ø¯ÙŠÙ†Ø© Ø§Ù„Ù…Ù†ÙˆØ±Ø©</li>
              </ul>
              <h2>Ø¯Ø¹ÙˆØ© Ù„Ù„Ø¹Ù…Ù„:</h2>
              <p>Ù„ØªØ±ØªÙŠØ¨ Ø§Ø¬ØªÙ…Ø§Ø¹ Ø£Ùˆ Ø²ÙŠØ§Ø±Ø© Ù…ÙŠØ¯Ø§Ù†ÙŠØ©ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ ÙÙŠ Ø£ÙŠ ÙˆÙ‚Øª. Ù†Ø­Ù† Ø¨Ø§Ù†ØªØ¸Ø§Ø± ØªØ¹Ø§ÙˆÙ† Ù…Ø«Ù…Ø± ÙˆØ¨Ù†Ø§Ø¡.</p>
              <div class="footer-section">
                <h2>Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¨Ù†ÙƒÙŠ</h2>
                <p>${data.bankDetails}</p>
              </div>
              <div class="page-footer">ØµÙØ­Ø© ${currentPageNumber + 1}</div>
            </div>
          </div>
          
        </body>
        </html>
      `;
      
      // 5. ÙØªØ­ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© ÙˆÙƒØªØ§Ø¨Ø© Ø§Ù„Ù€ HTML
      const previewWindow = window.open('', '_blank');
      previewWindow.document.write(previewHtml);
      previewWindow.document.close();
      
      showLoader(false);
      showStatus('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø© Ø¨Ù†Ø¬Ø§Ø­.', 'success');
    }

    // ================== Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø© ==================

    function showLoader(show, message = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„...') {
      loader.innerText = message;
      loader.style.display = show ? 'flex' : 'none';
      if (show) {
        statusMsg.style.display = 'none';
      }
    }
    
    function showStatus(message, type) {
      statusMsg.innerText = message;
      statusMsg.className = (type === 'success') ? 'status-success' : 'status-error';
      statusMsg.style.display = 'block';
    }
    
    function onDataFailed(message) {
      showLoader(false);
      showStatus(message, 'error');
      console.error(message);
    }
    
    // ===============================================
    // == Ø¯ÙˆØ§Ù„ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ (Gemini)
    // ===============================================

    /**
     * Ø¯Ø§Ù„Ø© Ù…Ø±ÙƒØ²ÙŠØ© Ù„Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Gemini API Ø¹Ø¨Ø± Google Apps Script
     * @param {string} prompt - Ù…ÙˆØ¬Ù‡ Ø§Ù„Ø£ÙˆØ§Ù…Ø± (Ø§Ù„Ø·Ù„Ø¨)
     * @param {string} loaderMessage - Ø±Ø³Ø§Ù„Ø© Ø§Ù„ØªØ­Ù…ÙŠÙ„
     * @returns {Promise<string>} - Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ù†ØµÙŠØ© Ù…Ù† Gemini
     */
    async function callGemini(prompt, loaderMessage = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªÙÙƒÙŠØ±...') {
      showLoader(true, loaderMessage);
      
      try {
        const response = await fetch(GAS_URL, {
          method: 'POST',
          body: JSON.stringify({
            action: 'callGemini', // Ù‡Ø°Ø§ Ù‡Ùˆ Ø§Ù„Ù…ÙØªØ§Ø­ Ø§Ù„Ø°ÙŠ Ø£Ø¶ÙÙ†Ø§Ù‡ ÙÙŠ doPost
            prompt: prompt
          }),
          headers: { 'Content-Type': 'application/json' },
          mode: 'cors'
        });

        if (!response.ok) {
          throw new Error(`Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø´Ø¨ÙƒØ©: ${response.statusText}`);
        }

        const result = await response.json();

        if (result.status === 'error') {
          throw new Error(result.message);
        }

        // Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ù†Øµ Ø§Ù„ØµØ§ÙÙŠ Ù…Ù† Gemini
        return result.text; 

      } catch (error) {
        showLoader(false);
        showStatus('ÙØ´Ù„ Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ: ' + error.message, 'error');
        console.error("Gemini Call Error:", error);
        return null; // Ø¥Ø±Ø¬Ø§Ø¹ null Ø¹Ù†Ø¯ Ø§Ù„ÙØ´Ù„
      }
      // (Ù…Ù„Ø§Ø­Ø¸Ø©: showLoader(false) Ø³ÙŠØªÙ… Ø§Ø³ØªØ¯Ø¹Ø§Ø¤Ù‡Ø§ Ù…Ù† Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ©)
    }

    /**
     * Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø§Ø®ØªÙŠØ§Ø±Ø§Øª Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø¨Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ
     * @param {string} type - Ù†ÙˆØ¹ Ø§Ù„Ø·Ù„Ø¨ (Ù…Ø«Ù„ 'economy_room')
     */
    async function generateAiSelection(type) {
      if (MASTER_ITEMS_LIST.length === 0) {
        alert('Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© Ù„Ù… ØªÙƒØªÙ…Ù„. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø£Ùˆ Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©.');
        return;
      }

      // 1. Ø¥Ù†Ø´Ø§Ø¡ Ù…ÙˆØ¬Ù‡ Ø§Ù„Ø£ÙˆØ§Ù…Ø± (Prompt)
      let requestText = '';
      if (type === 'economy_room') {
        requestText = 'ØºØ±ÙØ© Ù†ÙˆÙ… ÙÙ†Ø¯Ù‚ÙŠØ© Ø§Ù‚ØªØµØ§Ø¯ÙŠØ© (Ù…Ø³ØªÙˆÙ‰ Ø³Ø¹Ø± price_low)';
      } else if (type === 'medium_room') {
        requestText = 'ØºØ±ÙØ© Ù†ÙˆÙ… ÙÙ†Ø¯Ù‚ÙŠØ© Ø¨Ø¬ÙˆØ¯Ø© Ù…ØªÙˆØ³Ø·Ø© (Ù…Ø³ØªÙˆÙ‰ Ø³Ø¹Ø± price_medium)';
      } else if (type === 'luxury_reception') {
        requestText = 'Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ ÙÙ†Ø¯Ù‚ÙŠ ÙØ§Ø®Ø± (Ù…Ø³ØªÙˆÙ‰ Ø³Ø¹Ø± price_high)';
      }
      
      // ØªØ­ÙˆÙŠÙ„ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø¥Ù„Ù‰ Ù†Øµ Ù…Ø¨Ø³Ø· Ù„Ù€ Gemini
      const itemsListForPrompt = MASTER_ITEMS_LIST.map(item => {
        return `- ID: ${item.id}, Ø§Ù„Ø§Ø³Ù…: ${item.name}, Ø§Ù„ÙˆØµÙ: ${item.description}, Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ù†Ø®ÙØ¶: ${item.price_low}, Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…ØªÙˆØ³Ø·: ${item.price_medium}, Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ù…Ø±ØªÙØ¹: ${item.price_high}`;
      }).join('\n');

      const fullPrompt = `
        Ù…Ù‡Ù…ØªÙƒ Ù‡ÙŠ Ø§Ø®ØªÙŠØ§Ø± Ø¨Ù†ÙˆØ¯ Ù„Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ø±Ø¶ Ø³Ø¹Ø± ÙÙ†Ø¯Ù‚ÙŠ.
        
        Ø§Ù„Ø·Ù„Ø¨: ${requestText}

        Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø§Ù„Ù…ØªØ§Ø­Ø© (Master List):
        ${itemsListForPrompt}
        
        Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª:
        1.  Ø§Ù‚Ø±Ø£ "Ø§Ù„Ø·Ù„Ø¨" Ø¬ÙŠØ¯Ø§Ù‹.
        2.  Ø§Ø®ØªØ± Ø§Ù„Ø¨Ù†ÙˆØ¯ "Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©" ÙˆØ§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„Ù„Ø·Ù„Ø¨ Ù…Ù† "Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨Ù†ÙˆØ¯ Ø§Ù„Ù…ØªØ§Ø­Ø©". (Ù…Ø«Ø§Ù„: Ø§Ù„ØºØ±ÙØ© ØªØ­ØªØ§Ø¬ Ø³Ø±ÙŠØ±ØŒ Ø¯ÙˆÙ„Ø§Ø¨ØŒ Ø·Ø§ÙˆÙ„Ø© Ø¬Ø§Ù†Ø¨ÙŠØ©).
        3.  Ø­Ø¯Ø¯ Ø§Ù„ÙƒÙ…ÙŠØ© (qty) Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù„ÙƒÙ„ Ø¨Ù†Ø¯ (Ø¹Ø§Ø¯Ø© 1 Ø£Ùˆ 2 Ù„Ù„ØºØ±ÙØ©).
        4.  Ø£Ø¹Ø¯ Ø§Ù„Ø±Ø¯ **ÙÙ‚Ø·** Ø¨ØµÙŠØºØ© JSON ArrayØŒ Ø¨Ø¯ÙˆÙ† Ø£ÙŠ Ù†ØµÙˆØµ Ø¥Ø¶Ø§ÙÙŠØ©.
        5.  ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ù€ JSON Ø¨Ù‡Ø°Ø§ Ø§Ù„Ø´ÙƒÙ„: [{"id": "ID_Ù…Ù†_Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©", "qty": Ø§Ù„Ø¹Ø¯Ø¯}, ...]
        
        Ù…Ø«Ø§Ù„ Ù„Ù„Ø±Ø¯ (Ù„Ø§ ØªØ¶Ø¹Ù‡ ÙÙŠ Ø¥Ø¬Ø§Ø¨ØªÙƒ): [{"id": "item_12", "qty": 1}, {"id": "item_45", "qty": 2}]
      `;

      // 2. Ø§Ø³ØªØ¯Ø¹Ø§Ø¡ Gemini
      const geminiResponseText = await callGemini(fullPrompt, `Ø¬Ø§Ø±ÙŠ Ø¥Ù†Ø´Ø§Ø¡ "${requestText}"...`);
      
      if (!geminiResponseText) {
        showLoader(false);
        return; // ØªÙˆÙ‚Ù Ø¥Ø°Ø§ ÙØ´Ù„ Ø§Ù„Ø§Ø³ØªØ¯Ø¹Ø§Ø¡
      }

      // 3. Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø±Ø¯
      try {
        let itemsToAdd = JSON.parse(geminiResponseText);
        
        // Ø£Ø­ÙŠØ§Ù†Ø§Ù‹ ÙŠØ¶ÙŠÙ Gemini Ø§Ù„Ù€ JSON Ø¯Ø§Ø®Ù„ ```json ... ```
        if (typeof itemsToAdd !== 'object') {
           itemsToAdd = JSON.parse(geminiResponseText.replace(/```json\n|```/g, ''));
        }

        if (!Array.isArray(itemsToAdd)) {
           throw new Error('Ø§Ù„Ø±Ø¯ Ù„ÙŠØ³ Ø¨ØµÙŠØºØ© Array.');
        }

        // 4. Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ù†ÙˆØ¯ Ù„Ù„Ø¬Ø¯ÙˆÙ„
        let itemsAddedCount = 0;
        itemsToAdd.forEach(aiItem => {
          const itemData = MASTER_ITEMS_LIST.find(masterItem => masterItem.id === aiItem.id);
          const priceLevel = document.getElementById('priceLevel').value; // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ
          
          if (itemData) {
            const unitPrice = itemData[priceLevel] || 0;
            addQuoteItem({
              category: itemData.category,
              name: itemData.name,
              description: itemData.description,
              quantity: aiItem.qty || 1,
              unitPrice: unitPrice,
              totalPrice: (aiItem.qty || 1) * unitPrice
            });
            itemsAddedCount++;
          }
        });

        updateGrandTotal();
        saveDraft(); // Ø­ÙØ¸ Ø§Ù„Ù…Ø³ÙˆØ¯Ø©
        showLoader(false);
        showStatus(`ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© ${itemsAddedCount} Ø¨Ù†ÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­.`, 'success');

      } catch (e) {
        showLoader(false);
        showStatus('ÙØ´Ù„ ÙÙŠ ÙÙ‡Ù… Ø±Ø¯ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ: ' + e.message, 'error');
        console.error("Gemini Response Parse Error:", geminiResponseText);
      }
    }
  </script>
</body>

</html>

